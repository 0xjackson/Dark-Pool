flowchart TB
    subgraph Header[" "]
        H1["ğŸŒ‘ DARK POOL - FIVE LAYER ARCHITECTURE"]
    end

    subgraph Users["ğŸ‘¥ PARTICIPANTS"]
        direction LR
        U1["ğŸ‹ Whales"]
        U2["ğŸ¦ Institutions"]
        U3["ğŸ¤– Market Makers"]
        U4["ğŸ¢ Funds"]
    end

    subgraph L0["ğŸ–¥ï¸ LAYER 0: CLIENT"]
        direction TB
        L0_Title["User-Facing Application"]
        
        L0_A["ğŸ¦Š WALLET CONNECT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>MetaMask / WalletConnect<br/>Ledger / Coinbase Wallet<br/>Sign transactions"]
        
        L0_B["ğŸ¨ TRADING UI<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Order entry form<br/>Slippage selector<br/>Position dashboard"]
        
        L0_C["ğŸ“Š REAL-TIME DATA<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Live prices<br/>Order status<br/>Match notifications"]
        
        L0_D["ğŸ”” NOTIFICATIONS<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Match alerts<br/>Settlement confirmations<br/>Error handling"]
    end

    subgraph L1["âš™ï¸ LAYER 1: SERVER"]
        direction TB
        L1_Title["Backend Infrastructure"]
        
        L1_A["ğŸŒ API GATEWAY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>REST endpoints<br/>WebSocket connections<br/>Rate limiting"]
        
        L1_B["ğŸŸ¡ YELLOW SDK<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Clearnode connection<br/>State channel management<br/>Signature relay"]
        
        L1_C["ğŸ“Š ORDER MANAGER<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Track active orders<br/>Match notifications<br/>Settlement coordination"]
        
        L1_D["ğŸ’¾ DATABASE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Order history<br/>User preferences<br/>Analytics"]
    end

    subgraph L2["ğŸ“œ LAYER 2: CONSTRAINT ENFORCEMENT"]
        direction TB
        L2_Title["On-Chain Trustless Rules"]
        
        L2_A["ğŸ”’ ASSET LOCKING<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>User's tokens held in contract<br/>Released only on valid settle<br/>Or user cancellation"]
        
        L2_B["ğŸ”® ORACLE INTEGRATION<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Pyth price at order creation<br/>Immutable reference point<br/>No manipulation possible"]
        
        L2_C["ğŸ§® CONSTRAINT MATH<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>minOutput = amount Ã— price Ã— (1 - slippage)<br/>Stored on-chain<br/>Enforced at settlement"]
        
        L2_D["ğŸ›¡ï¸ SETTLEMENT GATE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>verifyAndSettle() must pass<br/>Rejects bad settlements<br/>Protects user always"]
    end

    subgraph L3["ğŸŸ¡ LAYER 3: PRIVATE MATCHING"]
        direction TB
        L3_Title["Off-Chain Yellow Network"]
        
        L3_A["ğŸ” ENCRYPTED ORDERS<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>AES-256 encryption<br/>Only matching engine decrypts<br/>Public sees nothing"]
        
        L3_B["ğŸ“’ DARK ORDERBOOK<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Orders indexed privately<br/>No public visibility<br/>MEV impossible"]
        
        L3_C["âš¡ P2P MATCHING<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Find counterparties<br/>Respect constraints<br/>Optimize execution"]
        
        L3_D["âœï¸ SIGNATURE COORD<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Collect both party sigs<br/>Bundle settlement params<br/>Submit to hook"]
    end

    subgraph L4["ğŸ¦„ LAYER 4: ATOMIC SETTLEMENT"]
        direction TB
        L4_Title["Uniswap v4 Hook"]
        
        L4_A["ğŸ” SIG VERIFICATION<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Both parties signed?<br/>Settlement hash valid?<br/>No forgery possible"]
        
        L4_B["ğŸ“ CONSTRAINT CALL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Hook â†’ Constraint Contract<br/>Verify all rules met<br/>REVERT if not"]
        
        L4_C["âš›ï¸ ATOMIC SWAP<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>PoolManager.take() + settle()<br/>All-or-nothing execution<br/>No partial fills"]
        
        L4_D["ğŸš« NO POOL LIQUIDITY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Pure P2P transfer<br/>Zero pool interaction<br/>No bank run risk"]
    end

    subgraph Result["âœ… RESULT"]
        direction LR
        R1["Private execution"]
        R2["Guaranteed slippage"]
        R3["Atomic settlement"]
        R4["Zero pool risk"]
    end

    Users --> L0
    L0 --> L1
    L1 --> L2
    L2 --> L3
    L3 --> L4
    L4 --> Result

    L0_A ~~~ L0_B ~~~ L0_C ~~~ L0_D
    L1_A ~~~ L1_B ~~~ L1_C ~~~ L1_D
    L2_A ~~~ L2_B ~~~ L2_C ~~~ L2_D
    L3_A ~~~ L3_B ~~~ L3_C ~~~ L3_D
    L4_A ~~~ L4_B ~~~ L4_C ~~~ L4_D

    style L0 fill:#6366F1,stroke:#4338CA,color:#fff
    style L1 fill:#8B5CF6,stroke:#6D28D9,color:#fff
    style L2 fill:#10B981,stroke:#047857,color:#fff
    style L3 fill:#F59E0B,stroke:#B45309,color:#000
    style L4 fill:#FF007A,stroke:#99004d,color:#fff
    style Result fill:#3B82F6,stroke:#1E40AF,color:#fff
