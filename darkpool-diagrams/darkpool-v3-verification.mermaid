flowchart TB
    subgraph Header[" "]
        H["ğŸ›¡ï¸ END-TO-END VERIFICATION FLOW"]
    end

    subgraph Client["ğŸ–¥ï¸ CLIENT"]
        C1["User submits order<br/>via Trading UI"]
        C2["Wallet signs tx"]
    end

    subgraph Server["âš™ï¸ SERVER"]
        SV1["Validate inputs"]
        SV2["Prepare tx params"]
        SV3["Submit to chain"]
    end

    subgraph Creation["ğŸ“œ ORDER CREATION"]
        CR1["Lock Assets<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>500 ETH â†’ Contract"]
        CR2["Oracle Snapshot<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Pyth: $2,000"]
        CR3["Calculate Min<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>$990,000 USDC"]
        CR4["Store On-Chain<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>orderId: 0xabc..."]
        
        CR1 --> CR2 --> CR3 --> CR4
    end

    subgraph Matching["ğŸŸ¡ YELLOW MATCHING"]
        M1["Encrypted order<br/>in dark pool"]
        M2["Counterparty found<br/>offering $995,000"]
        M3["Both sign<br/>settlement"]
    end

    subgraph Verification["ğŸ” SETTLEMENT VERIFICATION"]
        V1["Hook receives<br/>settlement request"]
        V2["Verify signatures<br/>from both parties"]
        V3["Call Constraint<br/>Contract"]
        V4{"All Checks<br/>Pass?"}
    end

    subgraph Checks["ğŸ“‹ CONSTRAINT CHECKS"]
        direction TB
        CH1{"Order<br/>active?"}
        CH2{"Not<br/>expired?"}
        CH3{"$995k â‰¥<br/>$990k?"}
        
        CH1 -->|"âœ…"| CH2
        CH2 -->|"âœ…"| CH3
    end

    subgraph Success["âœ… SUCCESS PATH"]
        S1["All checks pass"]
        S2["Atomic P2P settle"]
        S3["500 ETH â†’ Buyer"]
        S4["$995k â†’ Seller"]
        S5["Order complete"]
        
        S1 --> S2 --> S3 --> S4 --> S5
    end

    subgraph Notify["ğŸ”” NOTIFICATIONS"]
        N1["Hook emits event"]
        N2["Server receives"]
        N3["WebSocket push"]
        N4["Client updates UI"]
        N5["ğŸ‰ User sees success!"]
        
        N1 --> N2 --> N3 --> N4 --> N5
    end

    subgraph Failure["âŒ FAILURE PATHS"]
        F1["Order inactive"]
        F2["Order expired"]
        F3["Slippage exceeded"]
        F4["REVERT â›”"]
        F5["User's ETH safe"]
        F6["Client shows error"]
        
        F1 --> F4
        F2 --> F4
        F3 --> F4
        F4 --> F5 --> F6
    end

    Client --> Server --> Creation
    Creation --> Matching
    Matching --> Verification
    Verification --> V4
    V4 --> Checks
    
    CH1 -->|"âŒ"| F1
    CH2 -->|"âŒ"| F2
    CH3 -->|"âŒ"| F3
    CH3 -->|"âœ…"| Success
    
    S5 --> Notify

    style Client fill:#6366F1,stroke:#4338CA,color:#fff
    style Server fill:#8B5CF6,stroke:#6D28D9,color:#fff
    style Creation fill:#10B981,stroke:#047857,color:#fff
    style Matching fill:#F59E0B,stroke:#B45309,color:#000
    style Verification fill:#FF007A,stroke:#99004d,color:#fff
    style Success fill:#3B82F6,stroke:#1E40AF,color:#fff
    style Notify fill:#06B6D4,stroke:#0891B2,color:#fff
    style Failure fill:#7f1d1d,stroke:#dc2626,color:#fff
