classDiagram
    class ClientApp {
        <<React dApp>>
        +WagmiProvider provider
        +useState orderState
        +useWebSocket connection
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        +connectWallet()
        +submitOrder(params)
        +signSettlement(matchData)
        +subscribeToUpdates()
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        -handleMatchNotification()
        -handleSettlementComplete()
    }

    class APIServer {
        <<Express.js>>
        +Router orderRoutes
        +WebSocketServer wss
        +YellowSDK yellow
        +Database db
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        +POST /orders
        +GET /orders/:id
        +DELETE /orders/:id
        +WS /subscribe
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        -validateOrder(params)
        -broadcastUpdate(event)
    }

    class YellowSDKWrapper {
        <<Yellow Integration>>
        +ClearnodeClient client
        +StateChannelManager channels
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        +connect()
        +submitEncryptedOrder(order)
        +onMatchFound(callback)
        +relaySignature(orderId, sig)
        +getOrderStatus(orderId)
    }

    class DarkPoolConstraints {
        <<Solidity - Trust Layer>>
        +IPyth pyth
        +address darkPoolHook
        +mapping orders
        +mapping lockedBalances
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        +createOrder(sellToken, buyToken, amount, slippageBps, expiry, priceUpdate) bytes32
        +cancelOrder(orderId)
        +verifyAndSettle(orderId, counterparty, buyAmount) bool
        +getLockedTokens(orderId) tuple
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        -_getPrice(sellToken, buyToken) uint256
        -_calculateMinOutput() uint256
    }

    class Order {
        <<struct>>
        +address user
        +address sellToken
        +address buyToken
        +uint256 sellAmount
        +uint256 minBuyAmount
        +uint256 maxSlippageBps
        +uint256 oraclePriceAtCreation
        +uint256 expiry
        +bool active
    }

    class DarkPoolHook {
        <<Uniswap v4 Hook>>
        +IPoolManager poolManager
        +IDarkPoolConstraints constraints
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        +beforeSwap(sender, key, params, hookData) bytes4
        +afterSwap(sender, key, params, delta, hookData) bytes4
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        -_verifySignatures(settlement) bool
        -_executeP2PSettlement(params) 
    }

    class SettlementParams {
        <<struct>>
        +bytes32 orderId
        +bytes32 counterpartyOrderId
        +address seller
        +address buyer
        +uint256 sellAmount
        +uint256 buyAmount
        +bytes sellerSig
        +bytes buyerSig
    }

    class DarkOrderbook {
        <<Off-Chain / Yellow>>
        -encryptedOrders Map
        -matchingEngine
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        +submitEncryptedOrder(order)
        +findMatches(criteria) Match[]
        +collectSignatures(match)
        +submitToHook(settlement)
    }

    ClientApp --> APIServer : HTTP/WebSocket
    APIServer --> YellowSDKWrapper : manages
    APIServer --> DarkPoolConstraints : creates orders
    YellowSDKWrapper --> DarkOrderbook : submits orders
    DarkPoolConstraints "1" --> "*" Order : stores
    DarkPoolHook --> DarkPoolConstraints : verifies
    DarkPoolHook --> SettlementParams : processes
    DarkOrderbook --> DarkPoolHook : submits settlements

    note for ClientApp "ğŸ–¥ï¸ CLIENT\nReact + Wagmi\nUser interface"
    note for APIServer "âš™ï¸ SERVER\nOrder management\nYellow coordination"
    note for DarkPoolConstraints "ğŸ“œ CONSTRAINTS\nTrustless enforcement\nOn-chain rules"
    note for DarkOrderbook "ğŸŸ¡ YELLOW\nPrivate matching\nOff-chain orderbook"
    note for DarkPoolHook "ğŸ¦„ HOOK\nAtomic settlement\nP2P transfers"
